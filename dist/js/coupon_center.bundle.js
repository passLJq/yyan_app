!function(n){var i={};function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=267)}({0:function(e,t){e.exports=Vue},1:function(e,t,n){"use strict";function i(e,t,n,i,o,s,a,u){var r,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),a?(r=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=r):o&&(r=u?function(){o.call(this,this.$root.$options.shadowRoot)}:o),r)if(c.functional){c._injectStyles=r;var p=c.render;c.render=function(e,t){return r.call(t),p(e,t)}}else{var l=c.beforeCreate;c.beforeCreate=l?[].concat(l,r):[r]}return{exports:e,options:c}}n.d(t,"a",function(){return i})},128:function(e,t,n){"use strict";var i=n(60);n.n(i).a},25:function(e,t,n){e.exports=n.p+"img/couponNoData1.png"},267:function(e,t,n){"use strict";n.r(t);function i(){var i=this,e=i.$createElement,o=i._self._c||e;return o("section",[o("div",{staticClass:"coupon_center",style:i.unGet&&i.unGet.length?"":"display: none;"},i._l(i.unGet,function(t,n){return o("div",{key:n,staticClass:"cou_item",on:{click:function(e){return i.goCanUse(n,1)}}},[o("div",{staticClass:"ex"},[o("div",{staticClass:"left"},[o("div",[i._v(i._s(t.israandom?"??":t.facevalue))]),o("div",[i._v("元")])]),i._v(" "),o("div",{staticClass:"right"},[o("p",{staticClass:"unt"},[i._v("满"+i._s(t.uselimit)+"可用")]),i._v(" "),o("p",{staticClass:"date"},[i._v("可领取时间至: "+i._s(t.time))]),i._v(" "),o("p",{staticClass:"date"},[i._v("使用有效期："+i._s(t.useday)+"天")]),i._v(" "),o("p",{staticClass:"explain"},[i._v(i._s(t.israandom?"随机券":t.couponalias))])])]),i._v(" "),o("div",{staticClass:"btn",on:{click:function(e){return e.stopPropagation(),i.getCoupon(t.couponid,n)}}},[i._v("立即领取")])])}),0),i._v(" "),i.unGet?i._e():o("div",{staticClass:"coupon_center_nodata"},[o("img",{attrs:{src:n(25),alt:""}}),i._v(" "),o("p",[i._v("很遗憾")]),i._v(" "),o("p",[i._v("您暂无可领的优惠券")])])])}var o=n(0),s=n.n(o);i._withStripped=!0;var a={data:function(){return{companyid:"",unGet:"",hasGet:"",loadTimer:null,uid:"",fxshopid:"",unGetonclick:[]}},created:function(){if(this.uid=getname(),this.fxshopid=getname("SessionShopID"),window.api){var e=this;api.addEventListener({name:"loginSuccess"},function(e,t){this.uid=getname(),this.fxshopid=getname("SessionShopID")}),api.addEventListener({name:"loginout"},function(e,t){this.uid="",this.fxshopid=""}),api.setCustomRefreshHeaderInfo({bgColor:"#fff",images:["widget://image/suaxin1.png","widget://image/suaxin2.png","widget://image/suaxin3.png","widget://image/suaxin4.png","widget://image/suaxin5.png","widget://image/suaxin6.png","widget://image/suaxin7.png"],tips:{pull:"下拉刷新",threshold:"松开立即刷新",load:"正在刷新"}},function(){setTimeout(function(){e.getMsg()},1e3)})}},computed:{showHasGet:function(){var t=this,n=[];return this.hasGet&&0<this.hasGet.length&&this.uid?this.hasGet.map(function(e){t.fxshopid?n.push(e):"3"!=e.couponType&&n.push(e)}):n="",n}},mounted:function(){this.getMsg()},methods:{getMsg:function(){this.loadTimer=setTimeout(function(){showLoading()},500),this.companyid?this.getComCou():this.getAllCou()},getAllCou:function(){var t=this;https({url:siteUrl+"/Marketing/Coupon/GetCouponListJson",data:{ispaltform:3,uid:window.api?api.getPrefs({sync:!0,key:"SessionUserID"}):$api.getStorage("SessionUserID")},headers:1,successBack:function(e){t.couponBack(e)}})},getComCou:function(){var t=this;https({url:siteUrl+"/Marketing/Coupon/GetCouponListJson",data:{ispaltform:3,comid:this.companyid,isrb:"false",uid:window.api?api.getPrefs({sync:!0,key:"SessionUserID"}):$api.getStorage("SessionUserID")},headers:1,successBack:function(e){t.couponBack(e)}})},couponBack:function(e){var o=this;null!=this.loadTimer&&(hideLoading(),clearTimeout(this.loadTimer),this.loadTimer=null);var t=[];if(e.success&&1==e.status?e.Data.length&&e.Data.forEach(function(e){t.push(e)}):app.promsg(e.err),t.length){var s=[],a=[],u=[];t.forEach(function(e){if(!e.isover&&0<e.eachamount-e.getnum&&2!=e.couponType&&3!=e.couponType){e.time=o.getTime(e.endtime),e.state=o.getState(e.endtime);var t=e.userendtime.substring(0,10).replace(/\./g,"-");if(e.useday=o.DateDiff(t),1<=e.getnum)if(1<e.getnum)for(var n=0;n<e.getnum;n++)s.push(e);else s.push(e);u.push(!0),a.push(e)}else if(e.time=o.getTime(e.userendtime),e.state=o.getState(e.endtime),1<e.getnum)for(var i=0;i<e.getnum;i++)s.push(e);else s.push(e)}),s.length||(s=""),a.length||(a=""),this.hasGet=s,this.unGet=a,this.unGetonclick=u}window.api&&api.refreshHeaderLoadDone()},getState:function(e){var t=Date.now(),n=Date.parse(new Date(e))-t;return 0<n&&n<=432e6?1:n<=0?2:0},getTime:function(e){return e.split(" ")[0]},getCoupon:function(e,n){var i=this;i.unGetonclick[n]?(i.unGetonclick[n]=!1,https({url:siteUrl+"Marketing/Coupon/ReceiveCoupon",data:{uid:window.api?api.getPrefs({sync:!0,key:"SessionUserID"}):$api.getStorage("SessionUserID"),couponid:e},headers:1,successBack:function(e){if(e&&e.success&&1==e.status){i.unGetonclick[n]=!0,promptMsg("领取成功");var t=i.unGet[n];t.getnum+=1,t.eachamount-t.getnum<=0?(i.unGet.splice(n,1),0==i.unGet.length&&(i.unGet="")):i.unGet[n]=t,i.hasGet||(i.hasGet=[]),i.hasGet.push(t),i.$forceUpdate()}else if(5==e.status){promptMsg("该优惠券已全部领完了");i.unGet[n];i.unGet.splice(n,1),i.$forceUpdate()}else i.unGetonclick[n]=!0,promptMsg(e.err)},errorBack:function(e){i.unGetonclick[n]=!0,promptMsg(e.msg)}})):promptMsg("领取处理中,请勿重复点击")},goCanUse:function(e,t){var n="";if((n=t?this.unGet[e]:this.hasGet[e]).isCurrencyCoupon)6==n.couponType?openWin({name:"grouplist",url:"./grouplist.html",bgColor:"#f5f5f5",pageParam:{title:"劲爆拼团"}},1):7==n.couponType?openWin({name:"timebuy",url:"./timebuy.html",bgColor:"#fff",pageParam:{title:"限时抢购"}},1):(api.sendEvent({name:"gobackroot"}),setTimeout(function(){api.closeToWin({name:"root",animation:{type:"push",subType:"from_right"}})},500));else{var i="";6==n.couponType?i="groupbuy":7==n.couponType&&(i="rushbuy"),openWin({url:"./coupon_can_use.html",name:"coupon_can_use",pageParam:{title:"可用商品",way:i,couponid:n.couponid},bgColor:"#fff"},1)}},getUseEndTime:function(e){if(e){var t=e.split(" ")[0];return t&&""!=t&&null!=t?t:e}return""},DateDiff:function(e){var t,n,i,o=new Date;return t=(o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()).split("-"),n=new Date(t[1]+"/"+t[2]+"/"+t[0]),t=e.split("-"),i=new Date(t[1]+"/"+t[2]+"/"+t[0]),parseInt(Math.abs(n-i)/1e3/60/60/24)}}},u=(n(128),n(1)),r=Object(u.a)(a,i,[],!1,null,null,null);r.options.__file="src/page/coupon_center/coupon_center.vue";var c=r.exports;openapp?window.apiready=function(){new s.a({render:function(e){return e(c)}}).$mount("#app")}:new s.a({render:function(e){return e(c)}}).$mount("#app")},60:function(e,t,n){}});